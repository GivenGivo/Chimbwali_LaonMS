{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <title>Reports & Analytics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="icon"
      type="image/png"
      href="{% static 'images/logo-icon.png' %}"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                DEFAULT: "#5B21B6",
                dark: "#7C3AED",
              },
              accent: "#06b6d4",
              surface: {
                DEFAULT: "#fff",
                dark: "#18181b",
              },
            },
            boxShadow: {
              neu: "0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(91,33,182,0.10)",
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
  </head>
  <body
    class="bg-gradient-to-bl from-primary/10 via-accent/10 to-slate-100 dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark min-h-screen text-gray-800 dark:text-white"
  >
    <div
      id="preloader"
      class="fixed inset-0 flex items-center justify-center bg-blue z-50"
    >
      <img
        src="{% static 'images/logo.png' %}"
        alt="Company Logo"
        class="animate-spin w-20 h-20"
      />
    </div>

    <a 
      href="{% url 'ceo_dashboard' %}" 
      class="fixed top-4 left-4 z-50 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg shadow transition"
    >
      <i class="fa-solid fa-house mr-1"></i> Back Home
    </a>

    <main class="flex flex-col items-center justify-center px-4 py-10 md:py-12">
      <section
        class="w-full max-w-4xl bg-white dark:bg-surface-dark rounded-3xl shadow-neu p-8 md:p-10 transition-colors duration-300"
      >
        <div class="mb-6">
          <h1
            class="text-2xl md:text-3xl font-extrabold text-primary dark:text-accent mb-2 flex items-center gap-3"
          >
            <i class="fa-solid fa-chart-line"></i> Reports & Analytics
          </h1>
        </div>

        <!-- Filter Form -->
        <form
          method="get"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6"
        >
          <div>
            <label for="date" class="block text-sm font-semibold mb-1"
              >Filter by Date</label
            >
            <input
              type="date"
              name="date"
              id="date"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-transparent text-sm"
            />
          </div>
          <div>
            <label for="month" class="block text-sm font-semibold mb-1"
              >Filter by Month (1-12)</label
            >
            <input
              type="number"
              name="month"
              id="month"
              min="1"
              max="12"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-transparent text-sm"
            />
          </div>
          <div class="flex items-end">
            <button
              type="submit"
              class="w-full bg-primary dark:bg-accent text-white font-bold py-2 px-4 rounded-lg shadow hover:shadow-lg transition"
            >
              Apply Filter
            </button>
          </div>
        </form>

        <!-- Export Button -->
        <div class="flex justify-end mb-4">
          <a
            href="?{% if request.GET.date %}date={{ request.GET.date }}&{% endif %}{% if request.GET.month %}month={{ request.GET.month }}&{% endif %}export=pdf"
            class="inline-flex items-center gap-2 bg-primary dark:bg-accent text-white font-semibold py-2 px-5 rounded-lg shadow hover:shadow-lg transition"
          >
            <i class="fa-solid fa-file-pdf"></i> Export PDF
          </a>
        </div>

        <!-- Payment Table -->
        <div class="overflow-x-auto">
          <table
            class="min-w-full table-auto text-sm text-left border-collapse border border-gray-300 dark:border-gray-600"
          >
            <thead>
              <tr class="bg-primary text-white dark:bg-accent">
                <th
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600"
                >
                  Client
                </th>
                <th
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600"
                >
                  Amount (ZMW)
                </th>
                <th
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600"
                >
                  Date
                </th>
              </tr>
            </thead>
            <tbody>
              {% for day in repayment_days %}
              <tr class="hover:bg-primary/5 dark:hover:bg-accent/10 transition">
                <td class="px-4 py-2 border border-gray-300 dark:border-gray-600">
                  {{ day.loan.client.full_name }}
                </td>
                <td class="px-4 py-2 border border-gray-300 dark:border-gray-600">
                  {{ day.amount_paid|floatformat:2 }}
                </td>
                <td class="px-4 py-2 border border-gray-300 dark:border-gray-600">
                  {{ day.date|date:"M d, Y" }}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="3" class="text-center py-4 text-gray-400">
                  No paid repayments found.
                </td>
              </tr>
              {% endfor %}

            </tbody>
          </table>
        </div>

        <!-- Total Amount -->
        <div class="mt-6 text-lg font-bold text-right">
          Total Amount:
          <span class="text-primary dark:text-accent"
            >ZMW {{ total_amount }}</span
          >
        </div>
      </section>
    </main>
    <script>
      window.addEventListener("load", function () {
        const preloader = document.getElementById("preloader");
        if (preloader) {
          preloader.style.opacity = "0";
          preloader.style.visibility = "hidden";
          preloader.style.transition = "opacity 0.5s ease";

          // Optionally, remove from DOM after transition ends
          setTimeout(() => preloader.remove(), 600);
        }
      });
    </script>
  </body>
</html>
