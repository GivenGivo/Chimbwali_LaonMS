{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <title>Loan Officer Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="icon"
      type="image/png"
      href="{% static 'images/logo-icon.png' %}"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                DEFAULT: "#5B21B6",
                dark: "#7C3AED",
              },
              accent: "#06b6d4",
              surface: {
                DEFAULT: "#fff",
                dark: "#18181b",
              },
            },
            boxShadow: {
              neu: "0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(91,33,182,0.10)",
            },
          },
        },
      };
    </script>
    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
  </head>
  <body
    class="bg-gradient-to-tr from-primary/10 via-accent/10 to-slate-100 dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark min-h-screen flex flex-col transition-colors duration-300"
  >
    <div
      id="preloader"
      class="fixed inset-0 flex items-center justify-center bg-blue z-50"
    >
      <img
        src="{% static 'images/logo.png' %}"
        alt="Company Logo"
        class="animate-spin w-20 h-20"
      />
    </div>
    <!-- Dark mode toggle -->
    <button
      id="darkToggle"
      aria-label="Toggle dark mode"
      class="fixed top-4 right-4 z-20 text-primary dark:text-accent bg-white dark:bg-surface-dark shadow-neu rounded-full p-2 focus:outline-none transition-colors duration-200"
    >
      <i id="darkIcon" class="fa-solid fa-moon"></i>
    </button>

    <!-- Navbar/Header -->
    <header
      class="w-full flex items-center justify-between px-6 py-5 bg-white/80 dark:bg-surface-dark/80 shadow-neu backdrop-blur z-10"
    >
      <div class="flex items-center gap-2">
        <span class="text-2xl text-primary dark:text-accent"
          ><i class="fa-solid fa-briefcase"></i
        ></span>
        <span
          class="text-xl font-extrabold text-primary dark:text-accent tracking-tight"
          >Loan Officer</span
        >
        <span
          class="hidden sm:inline-block text-sm font-medium text-gray-400 dark:text-gray-500 pl-3 border-l border-gray-200 dark:border-gray-700 ml-3"
          >Dashboard</span
        >
      </div>
      <div class="flex items-center gap-2">
        <span class="font-medium text-gray-700 dark:text-gray-200">
          <i class="fa-solid fa-user text-primary dark:text-accent mr-1"></i>
          {{ request.user.username }}
        </span>
      </div>
    </header>

    <!-- Main Content -->
    <main
      class="flex-1 flex flex-col items-center justify-center px-4 py-10 md:py-12 bg-transparent"
    >
      <section
        class="w-full max-w-2xl bg-white dark:bg-surface-dark rounded-3xl shadow-neu p-8 md:p-10 flex flex-col gap-6 transition-colors duration-300"
      >
        <h1
          class="dashboard-title text-2xl md:text-3xl font-extrabold text-gray-900 dark:text-white mb-2"
        >
          Welcome,
          <span class="text-primary dark:text-accent"
            >{{ request.user.username }}</span
          >
        </h1>
        <p
          class="dashboard-description text-base text-gray-500 dark:text-gray-300 mb-4"
        ></p>
        <div class="dashboard-actions">
          <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <li>
              <a
                href="{% url 'register_client' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition"
              >
                <span class="text-2xl text-primary dark:text-accent"
                  ><i class="fa-solid fa-user-plus"></i
                ></span>
                Register New Client
              </a>
            </li>
            <li>
              <a
                href="{% url 'view_my_clients' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition"
              >
                <span class="text-2xl text-primary dark:text-accent"
                  ><i class="fa-solid fa-users"></i
                ></span>
                Clients Status
              </a>
            </li>
            <li>
              <a
                href="{% url 'submit_daily_report' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition"
              >
                <span class="text-2xl text-primary dark:text-accent"
                  ><i class="fa-solid fa-file-lines"></i
                ></span>
                Submit Daily Report
              </a>
            </li>
            <li>
              <a
                href="{% url 'view_approved_clients' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition"
              >
                <span class="text-2xl text-primary dark:text-accent"
                  ><i class="fa-solid fa-user-check"></i
                ></span>
                View Approved Clients
              </a>
            </li>
            <li>
              <a
                href="{% url 'print_monthly_summary' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition"
              >
                <span class="text-2xl text-primary dark:text-accent"
                  ><i class="fa-solid fa-print"></i
                ></span>
                Print Summary
              </a>
            </li>
            <li>
              <a
                href="{% url 'loan_officer_edit_profile' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition"
              >
                <span class="text-2xl text-primary dark:text-accent"
                  ><i class="fa-solid fa-user-pen"></i></span>
                Edit Profile
              </a>
            </li>
            <li>
              <button
                onclick="toggleLoanCalculator(true)"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-gray-100 dark:border-gray-800 bg-gradient-to-tr from-primary/5 via-accent/5 to-white dark:from-surface-dark dark:via-primary-dark/10 dark:to-surface-dark text-gray-900 dark:text-white font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-primary/10 dark:hover:bg-accent/10 transition w-full"
              >
                <span class="text-2xl text-primary dark:text-accent">
                  <i class="fa-solid fa-calculator"></i>
                </span>
                Loan Calculator
              </button>
            </li>

            <li class="sm:col-span-2">
              <a
                href="{% url 'logout' %}"
                class="flex items-center gap-3 p-5 rounded-2xl shadow border border-red-200 dark:border-red-700 bg-gradient-to-tr from-red-50 via-red-100 to-white dark:from-red-900/30 dark:via-red-900/20 dark:to-surface-dark text-red-700 dark:text-red-300 font-semibold hover:shadow-lg hover:-translate-y-1 hover:bg-red-100 dark:hover:bg-red-900/40 transition"
              >
                <span class="text-2xl"
                  ><i class="fa-solid fa-arrow-right-from-bracket"></i
                ></span>
                Logout
              </a>
            </li>
          </ul>
        </div>
      </section>
      <!-- Loan Calculator Modal -->
      <div id="loanCalculatorModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 z-50 px-4">
        <div class="bg-white dark:bg-surface-dark rounded-2xl p-6 w-full max-w-md shadow-neu relative">
          <button
            onclick="toggleLoanCalculator(false)"
            class="absolute top-3 right-4 text-gray-500 hover:text-red-600"
          >
            <i class="fa-solid fa-times"></i>
          </button>

          <h2 class="text-xl font-bold mb-4 text-primary dark:text-accent flex items-center gap-2">
            <i class="fa-solid fa-calculator"></i> Loan Calculator
          </h2>

          <div class="space-y-4">
            <div>
              <label for="loanAmountInput" class="block font-semibold text-gray-700 dark:text-gray-200">
                Enter Loan Amount
              </label>
              <input
                type="number"
                id="loanAmountInput"
                class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100"
                placeholder="e.g., 5000"
              />
            </div>

            <div>
              <label class="block font-semibold text-gray-700 dark:text-gray-200">Interest (37.8%)</label>
              <p id="interestAmount" class="text-lg font-bold text-primary dark:text-accent">ZMW 0.00</p>
            </div>

            <div>
              <label class="block font-semibold text-gray-700 dark:text-gray-200">Total Repayable</label>
              <p id="totalRepayable" class="text-lg font-bold text-primary dark:text-accent">ZMW 0.00</p>
            </div>

            <div>
              <label class="block font-semibold text-gray-700 dark:text-gray-200">Daily Amount (26 days)</label>
              <p id="dailyAmount" class="text-lg font-bold text-primary dark:text-accent">ZMW 0.00</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Dark mode toggle logic
      const darkToggle = document.getElementById("darkToggle");
      const html = document.documentElement;
      const darkIcon = document.getElementById("darkIcon");

      function setDarkMode(enable) {
        if (enable) {
          html.classList.add("dark");
          darkIcon.classList.remove("fa-moon");
          darkIcon.classList.add("fa-sun");
        } else {
          html.classList.remove("dark");
          darkIcon.classList.remove("fa-sun");
          darkIcon.classList.add("fa-moon");
        }
      }
      // Detect user/system preference
      let dark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      setDarkMode(dark);

      darkToggle.addEventListener("click", () => {
        dark = !html.classList.contains("dark");
        setDarkMode(dark);
      });
    </script>
    <script>
      window.addEventListener("load", function () {
        const preloader = document.getElementById("preloader");
        if (preloader) {
          preloader.style.opacity = "0";
          preloader.style.visibility = "hidden";
          preloader.style.transition = "opacity 0.5s ease";

          // Optionally, remove from DOM after transition ends
          setTimeout(() => preloader.remove(), 600);
        }
      });
    </script>
    <script>
      const calculatorModal = document.getElementById("loanCalculatorModal");
      const loanAmountInput = document.getElementById("loanAmountInput");
      const interestAmount = document.getElementById("interestAmount");
      const totalRepayable = document.getElementById("totalRepayable");
      const dailyAmount = document.getElementById("dailyAmount");

      function toggleLoanCalculator(show) {
        if (show) {
          calculatorModal.classList.remove("hidden");
          calculatorModal.classList.add("flex");
        } else {
          calculatorModal.classList.remove("flex");
          calculatorModal.classList.add("hidden");
        }
      }

      function updateLoanCalculations() {
        const rawAmount = parseFloat(loanAmountInput.value);
        const interestRate = 0.378;
        const days = 26;

        if (!isNaN(rawAmount) && rawAmount > 0) {
          const interest = rawAmount * interestRate;
          const total = rawAmount + interest;
          const daily = total / days;

          interestAmount.textContent = `ZMW ${interest.toFixed(2)}`;
          totalRepayable.textContent = `ZMW ${total.toFixed(2)}`;
          dailyAmount.textContent = `ZMW ${daily.toFixed(2)}`;
        } else {
          interestAmount.textContent = "ZMW 0.00";
          totalRepayable.textContent = "ZMW 0.00";
          dailyAmount.textContent = "ZMW 0.00";
        }
      }

      loanAmountInput.addEventListener("input", updateLoanCalculations);
    </script>
  </body>
</html>
